<!DOCTYPE html>
<html>
<head>
  <title>AC Remote</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: system-ui; 
      text-align: center; 
      padding: 20px; 
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .widget { 
      max-width: 360px; 
      margin: 0 auto; 
      background: white; 
      border-radius: 20px; 
      padding: 28px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    h1 { margin-top: 0; color: #2c3e50; }
    .power-btn { 
      background: #2ecc71; 
      color: white; 
      border: none; 
      padding: 16px 0; 
      width: 100%; 
      border-radius: 14px; 
      font-size: 20px; 
      font-weight: 700; 
      cursor: pointer; 
    }
    .temp-controls { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 16px; 
      margin-top: 24px;
    }
    .temp-value { 
      font-size: 28px; 
      font-weight: 700; 
      color: #2c3e50;
    }
    .temp-slider {
      width: 100%;
      margin: 20px 0;
    }
    .status {
      margin-top: 20px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 12px;
      color: #7f8c8d;
    }
  </style>
</head>
<body>
  <div class="widget">
    <h1>AC Remote</h1>
    
    <button class="power-btn" onclick="togglePower()">
      <span id="powerStatus">POWER ON</span>
    </button>
    
    <input type="range" min="16" max="30" value="24" class="temp-slider" id="tempSlider" onchange="setTemp(this.value)">
    <div class="temp-value"><span id="tempValue">24</span>Â°C</div>
    
    <div class="status">
      AC Status: <span id="acStatus">OFF</span>
    </div>
    
    <div style="margin-top: 20px;">
      <button onclick="startLearning('power_on')">Learn Power ON</button>
      <button onclick="startLearning('power_off')">Learn Power OFF</button>
    </div>
  </div>

  <script>
    const VERCEL_URL = "https://your-project.vercel.app";
    
    async function togglePower() {
      const isOn = document.getElementById("acStatus").textContent === "OFF";
      await fetch(`${VERCEL_URL}/api/ac/power`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ on: isOn })
      });
      await updateState();
    }
    
    async function setTemp(temp) {
      document.getElementById("tempValue").textContent = temp;
      await fetch(`${VERCEL_URL}/api/ac/temp`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ temp: parseInt(temp) })
      });
    }
    
    async function startLearning(cmd) {
      alert(`Press "${cmd}" on your AC remote now!`);
      // In real app: send command to ESP32 via WebSocket or HTTP
      console.log("Learning mode not implemented in demo");
    }
    
    async function updateState() {
      try {
        const res = await fetch(`${VERCEL_URL}/api/ac/state`);
        const data = await res.json();
        document.getElementById("acStatus").textContent = data.power ? "ON" : "OFF";
        document.getElementById("powerStatus").textContent = data.power ? "POWER OFF" : "POWER ON";
        document.getElementById("tempValue").textContent = data.temp;
        document.getElementById("tempSlider").value = data.temp;
      } catch (e) {
        console.error("Failed to fetch state");
      }
    }
    
    setInterval(updateState, 3000);
    updateState();
  </script>
</body>
</html>